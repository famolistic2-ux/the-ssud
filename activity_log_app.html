<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SU President Timesheet Tracker - City of Wolverhampton College</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'cwc-gold': '#D4AF37',
                        'cwc-yellow': '#F4D03F',
                        'cwc-navy': '#1A1A2E',
                        'cwc-dark': '#16213E',
                        'cwc-light': '#F8F9FA'
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'pulse-success': 'pulseSuccess 0.6s ease-in-out',
                        'bounce-in': 'bounceIn 0.5s ease-out'
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes pulseSuccess {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); opacity: 1; }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .dark .glass-effect {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .floating-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 50;
            pointer-events: auto;
        }
        @media (max-width: 768px) {
            .floating-btn {
                bottom: 80px;
            }
        }
        
        /* Desktop improvements */
        @media (min-width: 1024px) {
            .container {
                max-width: 1200px;
            }
            .touch-friendly {
                min-height: auto;
                padding: 8px 12px;
            }
        }
        .timer-pulse {
            animation: pulse 2s infinite;
        }
        .voice-recording {
            animation: pulse 1s infinite;
        }
        /* Dark mode styles */
        .dark {
            background: #0f172a;
            color: #f1f5f9;
        }
        .dark .bg-white { background-color: #1e293b; }
        .dark .bg-gray-50 { background-color: #334155; }
        .dark .bg-gray-100 { background-color: #475569; }
        .dark .text-gray-700 { color: #cbd5e1; }
        .dark .text-gray-600 { color: #94a3b8; }
        .dark .text-gray-800 { color: #f1f5f9; }
        .dark .border-gray-200 { border-color: #475569; }
        .dark .border { border-color: #475569; }

        /* Ensure all interactive elements are clickable */
        button, input, textarea, select, .nav-tab, .mobile-nav {
            pointer-events: auto !important;
            cursor: pointer !important;
            position: relative !important;
            z-index: 10 !important;
        }
        input, textarea {
            cursor: text !important;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-cwc-light to-gray-100 min-h-screen transition-all duration-300">
    <!-- Header with College Branding -->
    <header class="bg-gradient-to-r from-cwc-navy to-cwc-dark text-white shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 bg-cwc-gold rounded-lg flex items-center justify-center font-bold text-cwc-navy text-xl">
                        W
                    </div>
                    <div>
                        <h1 class="text-lg sm:text-xl font-bold">SU President Timesheet</h1>
                        <p class="text-xs sm:text-sm text-cwc-yellow">City of Wolverhampton College</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <button id="darkModeToggle" class="p-2 rounded-lg bg-cwc-dark hover:bg-opacity-80 transition-colors">
                        <span class="text-cwc-gold">🌙</span>
                    </button>
                    <button id="notificationToggle" class="p-2 rounded-lg bg-cwc-dark hover:bg-opacity-80 transition-colors">
                        <span class="text-cwc-gold">🔔</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-3 sm:px-4 py-6 max-w-7xl">
        <!-- Navigation Tabs -->
        <nav class="mb-6 bg-white dark:bg-gray-800 rounded-lg shadow-md p-2 animate-fade-in">
            <div class="flex flex-wrap gap-2">
                <button class="nav-tab active bg-cwc-gold text-cwc-navy px-4 py-2 rounded-md font-medium transition-all" data-view="dashboard">Dashboard</button>
                <button class="nav-tab bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-md font-medium transition-all hover:bg-cwc-yellow" data-view="activities">Activities</button>
                <button class="nav-tab bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-md font-medium transition-all hover:bg-cwc-yellow" data-view="analytics">Analytics</button>
                <button class="nav-tab bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-md font-medium transition-all hover:bg-cwc-yellow" data-view="calendar">Calendar</button>
                <button class="nav-tab bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-md font-medium transition-all hover:bg-cwc-yellow" data-view="timer">Timer</button>
            </div>
        </nav>

        <!-- Dashboard View -->
        <div id="dashboardView" class="view-content">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <!-- Progress Card -->
                <div class="lg:col-span-2 bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 animate-slide-up">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold text-gray-800 dark:text-white">Monthly Progress</h2>
                        <div id="hoursStatus" class="px-4 py-2 rounded-full text-sm font-medium"></div>
                    </div>
                    
                    <div class="space-y-6">
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-gray-600 dark:text-gray-300">Total Hours</span>
                                <span id="totalHours" class="text-3xl font-bold text-cwc-gold">0.00</span>
                            </div>
                            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4">
                                <div id="progressBar" class="bg-gradient-to-r from-cwc-gold to-cwc-yellow h-4 rounded-full transition-all duration-500" style="width: 0%"></div>
                            </div>
                            <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1">
                                <span>0hrs</span>
                                <span>30hrs (Required)</span>
                            </div>
                        </div>

                        <!-- Quick Stats -->
                        <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                            <div class="text-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                <div class="text-2xl font-bold text-blue-600" id="helpDeskHours">0</div>
                                <div class="text-xs text-blue-500">Help Desk</div>
                            </div>
                            <div class="text-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                <div class="text-2xl font-bold text-green-600" id="meetingHours">0</div>
                                <div class="text-xs text-green-500">Meetings</div>
                            </div>
                            <div class="text-center p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                                <div class="text-2xl font-bold text-purple-600" id="eventHours">0</div>
                                <div class="text-xs text-purple-500">Events</div>
                            </div>
                            <div class="text-center p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg">
                                <div class="text-2xl font-bold text-orange-600" id="otherHours">0</div>
                                <div class="text-xs text-orange-500">Other</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 animate-slide-up">
                    <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4">Quick Actions</h3>
                    <div class="space-y-3">
                        <button class="quick-add-btn w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white p-3 rounded-lg font-medium transition-all transform hover:scale-105" data-activity="SU Help Desk">
                            📞 Log Help Desk
                        </button>
                        <button class="quick-add-btn w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white p-3 rounded-lg font-medium transition-all transform hover:scale-105" data-activity="Meeting">
                            🤝 Log Meeting
                        </button>
                        <button class="quick-add-btn w-full bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white p-3 rounded-lg font-medium transition-all transform hover:scale-105" data-activity="Event">
                            🎉 Log Event
                        </button>
                        <button id="startTimerBtn" class="w-full bg-gradient-to-r from-cwc-gold to-cwc-yellow text-cwc-navy p-3 rounded-lg font-medium transition-all transform hover:scale-105">
                            ⏱️ Start Timer
                        </button>
                    </div>
                </div>
            </div>

            <!-- Monthly Summary -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-6 animate-slide-up">
                <h2 class="text-xl font-bold text-gray-800 dark:text-white mb-4">Monthly Summary</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">What went well this month and what challenges did you overcome?</label>
                        <textarea id="monthlySummary" rows="4" 
                            class="w-full p-4 border border-gray-200 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-cwc-gold dark:bg-gray-700 dark:text-white transition-all" 
                            placeholder="Describe your overall experience this month, highlighting successes and challenges..."></textarea>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <button id="voiceNoteBtn" class="flex items-center space-x-2 bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                            <span>🎤</span>
                            <span>Voice Note</span>
                        </button>
                        <button id="photoBtn" class="flex items-center space-x-2 bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-lg transition-colors">
                            <span>📷</span>
                            <span>Add Photo</span>
                        </button>
                        <input type="file" id="photoInput" accept="image/*" class="hidden">
                    </div>
                    <div id="photoGallery" class="grid grid-cols-2 sm:grid-cols-4 gap-2"></div>
                </div>
            </div>
        </div>

        <!-- Activities View -->
        <div id="activitiesView" class="view-content hidden">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 gap-4">
                    <h2 class="text-xl font-bold text-gray-800 dark:text-white">Activity Log</h2>
                    <div class="flex flex-wrap gap-2">
                        <button class="preset-btn bg-cwc-gold hover:bg-cwc-yellow text-cwc-navy px-3 py-2 rounded-lg font-medium transition-colors" data-hours="1">1hr</button>
                        <button class="preset-btn bg-cwc-gold hover:bg-cwc-yellow text-cwc-navy px-3 py-2 rounded-lg font-medium transition-colors" data-hours="2">2hrs</button>
                        <button class="preset-btn bg-cwc-gold hover:bg-cwc-yellow text-cwc-navy px-3 py-2 rounded-lg font-medium transition-colors" data-hours="3">3hrs</button>
                        <button id="addRowButton" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            Add Activity
                        </button>
                    </div>
                </div>

                <div id="timeLogContainer" class="space-y-4">
                    <!-- Activity rows will be dynamically added here -->
                </div>

                <div class="mt-6 flex flex-wrap gap-2">
                    <button id="clearButton" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                        Clear All
                    </button>
                    <button id="generateButton" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                        Generate Report
                    </button>
                </div>
            </div>
        </div>

        <!-- Analytics View -->
        <div id="analyticsView" class="view-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4">Activity Breakdown</h3>
                    <canvas id="activityChart" width="400" height="300"></canvas>
                </div>
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4">Weekly Progress</h3>
                    <canvas id="weeklyChart" width="400" height="300"></canvas>
                </div>
                <div class="lg:col-span-2 bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4">Monthly Trends</h3>
                    <canvas id="trendsChart" width="800" height="300"></canvas>
                </div>
            </div>
        </div>

        <!-- Calendar View -->
        <div id="calendarView" class="view-content hidden">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-gray-800 dark:text-white">Calendar View</h2>
                    <div class="flex items-center space-x-2">
                        <button id="prevMonth" class="p-2 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 transition-colors">←</button>
                        <span id="currentMonth" class="px-4 py-2 font-medium"></span>
                        <button id="nextMonth" class="p-2 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 transition-colors">→</button>
                    </div>
                </div>
                <div id="calendar" class="grid grid-cols-7 gap-1 text-center">
                    <!-- Calendar will be generated by JS -->
                </div>
            </div>
        </div>

        <!-- Timer View -->
        <div id="timerView" class="view-content hidden">
            <div class="max-w-md mx-auto bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 text-center">
                <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-6">Activity Timer</h2>
                
                <div class="mb-6">
                    <input type="text" id="timerActivity" placeholder="Enter activity name..." class="w-full p-3 border rounded-lg text-center font-medium dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                </div>

                <div id="timerDisplay" class="text-6xl font-mono font-bold text-cwc-gold mb-8">00:00:00</div>
                
                <div class="space-y-4">
                    <button id="timerStartStop" class="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white p-4 rounded-lg font-bold text-lg transition-all transform hover:scale-105">
                        START
                    </button>
                    <button id="timerPause" class="w-full bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white p-3 rounded-lg font-medium transition-all" disabled>
                        PAUSE
                    </button>
                    <button id="timerSave" class="w-full bg-gradient-to-r from-cwc-gold to-cwc-yellow text-cwc-navy p-3 rounded-lg font-medium transition-all" disabled>
                        SAVE ACTIVITY
                    </button>
                </div>
            </div>
        </div>

        <!-- Message Box -->
        <div id="messageBox" class="hidden fixed top-20 right-4 p-4 rounded-lg shadow-lg z-50 animate-bounce-in"></div>

        <!-- Output Section -->
        <div id="outputSection" class="hidden mt-8 bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 animate-slide-up">
            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 gap-3">
                <h2 class="text-xl font-bold text-gray-800 dark:text-white">Monthly Report</h2>
                <button id="copyButton" class="bg-cwc-gold hover:bg-cwc-yellow text-cwc-navy px-4 py-2 rounded-lg font-medium transition-colors">
                    Copy to Clipboard
                </button>
            </div>
            <pre id="reportOutput" class="bg-gray-50 dark:bg-gray-900 p-4 rounded-lg border text-sm overflow-x-auto whitespace-pre-wrap dark:text-gray-100"></pre>
        </div>
    </div>

    <!-- Floating Action Button -->
    <button id="fabBtn" class="floating-btn bg-gradient-to-r from-cwc-gold to-cwc-yellow text-cwc-navy w-14 h-14 rounded-full shadow-lg flex items-center justify-center text-xl font-bold hover:shadow-xl transition-all transform hover:scale-110">
        +
    </button>

    <!-- Bottom Navigation (Mobile) -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t dark:border-gray-700 sm:hidden">
        <div class="grid grid-cols-5 py-2">
            <button class="mobile-nav flex flex-col items-center py-2 text-xs" data-view="dashboard">
                <span class="text-lg mb-1">📊</span>
                <span>Dashboard</span>
            </button>
            <button class="mobile-nav flex flex-col items-center py-2 text-xs" data-view="activities">
                <span class="text-lg mb-1">📝</span>
                <span>Activities</span>
            </button>
            <button class="mobile-nav flex flex-col items-center py-2 text-xs" data-view="analytics">
                <span class="text-lg mb-1">📈</span>
                <span>Analytics</span>
            </button>
            <button class="mobile-nav flex flex-col items-center py-2 text-xs" data-view="calendar">
                <span class="text-lg mb-1">📅</span>
                <span>Calendar</span>
            </button>
            <button class="mobile-nav flex flex-col items-center py-2 text-xs" data-view="timer">
                <span class="text-lg mb-1">⏱️</span>
                <span>Timer</span>
            </button>
        </div>
    </nav>

    <!-- Voice Note Modal -->
    <div id="voiceModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 m-4 max-w-sm w-full">
            <h3 class="text-lg font-bold mb-4 dark:text-white">Voice Note</h3>
            <div class="text-center">
                <div id="voiceStatus" class="mb-4 text-gray-600 dark:text-gray-300">Press to start recording</div>
                <button id="voiceRecordBtn" class="bg-red-500 hover:bg-red-600 text-white w-16 h-16 rounded-full flex items-center justify-center text-2xl transition-colors">
                    🎤
                </button>
                <div class="mt-4 flex justify-end space-x-2">
                    <button id="voiceCancelBtn" class="px-4 py-2 bg-gray-300 dark:bg-gray-600 rounded-lg">Cancel</button>
                    <button id="voiceSaveBtn" class="px-4 py-2 bg-green-500 text-white rounded-lg" disabled>Save</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let appState = {
            currentView: 'dashboard',
            isDarkMode: localStorage.getItem('darkMode') === 'true',
            timerInterval: null,
            timerStartTime: null,
            timerElapsed: 0,
            isTimerRunning: false,
            mediaRecorder: null,
            audioChunks: [],
            notificationsEnabled: localStorage.getItem('notifications') === 'true',
            localEntries: {},
            entryCounter: 1,
            charts: {
                activity: null,
                weekly: null,
                trends: null
            }
        };

        // Initialize app when DOM is ready
        function initializeApp() {
            console.log('Initializing app...');
            
            // Apply dark mode immediately
            if (appState.isDarkMode) {
                document.documentElement.classList.add('dark');
                const darkToggle = document.getElementById('darkModeToggle');
                if (darkToggle) {
                    darkToggle.innerHTML = '<span class="text-cwc-gold">☀️</span>';
                }
            }

            // Update notification toggle
            const notificationToggle = document.getElementById('notificationToggle');
            if (appState.notificationsEnabled && notificationToggle) {
                notificationToggle.classList.add('bg-cwc-gold');
            }

            // Initialize with dashboard view
            showView('dashboard');
            
            // Add initial activity row
            addInitialRow();
            
            // Load saved data
            loadMonthlySummary();
            
            // Update displays
            updateTotalHours();
            updateHoursStatus();
            updateQuickStats();
            
            console.log('App initialized successfully');
        }

        function setupEventListeners() {
            console.log('Setting up event listeners...');
            
            // Dark mode toggle
            const darkModeToggle = document.getElementById('darkModeToggle');
            if (darkModeToggle) {
                darkModeToggle.addEventListener('click', toggleDarkMode);
                console.log('Dark mode toggle attached');
            }
            
            // Notification toggle
            const notificationToggle = document.getElementById('notificationToggle');
            if (notificationToggle) {
                notificationToggle.addEventListener('click', toggleNotifications);
                console.log('Notification toggle attached');
            }

            // Navigation tabs
            const navTabs = document.querySelectorAll('.nav-tab');
            navTabs.forEach(tab => {
                tab.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    const view = tab.dataset.view;
                    console.log('Nav tab clicked:', view);
                    showView(view);
                });
            });
            console.log('Nav tabs attached:', navTabs.length);

            // Mobile navigation
            const mobileNavs = document.querySelectorAll('.mobile-nav');
            mobileNavs.forEach(nav => {
                nav.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    const view = nav.dataset.view;
                    console.log('Mobile nav clicked:', view);
                    showView(view);
                });
            });
            console.log('Mobile nav attached:', mobileNavs.length);

            // Quick add buttons
            const quickAddButtons = document.querySelectorAll('.quick-add-btn');
            quickAddButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    const activityName = button.dataset.activity;
                    console.log('Quick add clicked:', activityName);
                    addEntry({ activity: activityName });
                    showMessage(`Added ${activityName} entry`, 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300');
                });
            });
            console.log('Quick add buttons attached:', quickAddButtons.length);

            // Preset hours buttons
            const presetButtons = document.querySelectorAll('.preset-btn');
            presetButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    const hours = parseInt(button.dataset.hours);
                    console.log('Preset button clicked:', hours);
                    const now = new Date();
                    const endTime = now.toTimeString().slice(0, 5);
                    const startTime = new Date(now.getTime() - (hours * 60 * 60 * 1000)).toTimeString().slice(0, 5);
                    
                    addEntry({ 
                        startTime: startTime, 
                        endTime: endTime,
                        activity: 'SU Help Desk'
                    });
                    showMessage(`Added ${hours}hr activity`, 'bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300');
                });
            });
            console.log
            console.log('Preset buttons attached:', presetButtons.length);

            // Add row button
            const addRowButton = document.getElementById('addRowButton');
            if (addRowButton) {
                addRowButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Add row button clicked');
                    addActivityRow();
                });
            }

            // Clear and generate buttons
            const clearButton = document.getElementById('clearButton');
            if (clearButton) {
                clearButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Clear button clicked');
                    clearAllEntries();
                });
            }

            const generateButton = document.getElementById('generateButton');
            if (generateButton) {
                generateButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Generate button clicked');
                    generateReport();
                });
            }

            // Timer functionality
            const timerStartStop = document.getElementById('timerStartStop');
            const timerPause = document.getElementById('timerPause');
            const timerSave = document.getElementById('timerSave');
            const timerActivity = document.getElementById('timerActivity');

            if (timerStartStop) {
                timerStartStop.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Timer start/stop clicked');
                    toggleTimer();
                });
            }

            if (timerPause) {
                timerPause.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Timer pause clicked');
                    pauseTimer();
                });
            }

            if (timerSave) {
                timerSave.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Timer save clicked');
                    saveTimerActivity();
                });
            }

            // Start timer button from dashboard
            const startTimerBtn = document.getElementById('startTimerBtn');
            if (startTimerBtn) {
                startTimerBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Start timer from dashboard clicked');
                    showView('timer');
                });
            }

            // Voice note functionality
            const voiceNoteBtn = document.getElementById('voiceNoteBtn');
            const voiceModal = document.getElementById('voiceModal');
            const voiceRecordBtn = document.getElementById('voiceRecordBtn');
            const voiceCancelBtn = document.getElementById('voiceCancelBtn');
            const voiceSaveBtn = document.getElementById('voiceSaveBtn');

            if (voiceNoteBtn) {
                voiceNoteBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Voice note button clicked');
                    showVoiceModal();
                });
            }

            if (voiceRecordBtn) {
                voiceRecordBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Voice record button clicked');
                    toggleVoiceRecording();
                });
            }

            if (voiceCancelBtn) {
                voiceCancelBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Voice cancel button clicked');
                    hideVoiceModal();
                });
            }

            if (voiceSaveBtn) {
                voiceSaveBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Voice save button clicked');
                    saveVoiceNote();
                });
            }

            // Photo functionality
            const photoBtn = document.getElementById('photoBtn');
            const photoInput = document.getElementById('photoInput');

            if (photoBtn) {
                photoBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Photo button clicked');
                    photoInput.click();
                });
            }

            if (photoInput) {
                photoInput.addEventListener('change', (e) => {
                    console.log('Photo selected');
                    handlePhotoUpload(e);
                });
            }

            // Monthly summary
            const monthlySummary = document.getElementById('monthlySummary');
            if (monthlySummary) {
                monthlySummary.addEventListener('input', (e) => {
                    saveMonthlySummary();
                });
            }

            // FAB button
            const fabBtn = document.getElementById('fabBtn');
            if (fabBtn) {
                fabBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('FAB clicked');
                    showView('activities');
                });
            }

            // Calendar navigation
            const prevMonth = document.getElementById('prevMonth');
            const nextMonth = document.getElementById('nextMonth');

            if (prevMonth) {
                prevMonth.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Previous month clicked');
                    changeMonth(-1);
                });
            }

            if (nextMonth) {
                nextMonth.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Next month clicked');
                    changeMonth(1);
                });
            }

            // Copy button
            const copyButton = document.getElementById('copyButton');
            if (copyButton) {
                copyButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Copy button clicked');
                    copyReport();
                });
            }

            console.log('All event listeners attached successfully');
        }

        // View management
        function showView(viewName) {
            console.log('Switching to view:', viewName);
            
            // Hide all views
            const views = document.querySelectorAll('.view-content');
            views.forEach(view => view.classList.add('hidden'));
            
            // Show selected view
            const selectedView = document.getElementById(viewName + 'View');
            if (selectedView) {
                selectedView.classList.remove('hidden');
            }
            
            // Update navigation tabs
            const navTabs = document.querySelectorAll('.nav-tab');
            navTabs.forEach(tab => {
                if (tab.dataset.view === viewName) {
                    tab.classList.add('active', 'bg-cwc-gold', 'text-cwc-navy');
                    tab.classList.remove('bg-gray-100', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                } else {
                    tab.classList.remove('active', 'bg-cwc-gold', 'text-cwc-navy');
                    tab.classList.add('bg-gray-100', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                }
            });
            
            // Update mobile navigation
            const mobileNavs = document.querySelectorAll('.mobile-nav');
            mobileNavs.forEach(nav => {
                if (nav.dataset.view === viewName) {
                    nav.classList.add('text-cwc-gold');
                } else {
                    nav.classList.remove('text-cwc-gold');
                }
            });
            
            appState.currentView = viewName;
            
            // Initialize view-specific functionality
            if (viewName === 'analytics') {
                initializeCharts();
            } else if (viewName === 'calendar') {
                generateCalendar();
            }
        }

        // Dark mode toggle
        function toggleDarkMode() {
            console.log('Toggling dark mode');
            appState.isDarkMode = !appState.isDarkMode;
            document.documentElement.classList.toggle('dark', appState.isDarkMode);
            localStorage.setItem('darkMode', appState.isDarkMode);
            
            const darkToggle = document.getElementById('darkModeToggle');
            if (darkToggle) {
                darkToggle.innerHTML = appState.isDarkMode ? 
                    '<span class="text-cwc-gold">☀️</span>' : 
                    '<span class="text-cwc-gold">🌙</span>';
            }
        }

        // Notification toggle
        function toggleNotifications() {
            console.log('Toggling notifications');
            appState.notificationsEnabled = !appState.notificationsEnabled;
            localStorage.setItem('notifications', appState.notificationsEnabled);
            
            const notificationToggle = document.getElementById('notificationToggle');
            if (notificationToggle) {
                if (appState.notificationsEnabled) {
                    notificationToggle.classList.add('bg-cwc-gold');
                } else {
                    notificationToggle.classList.remove('bg-cwc-gold');
                }
            }
        }

        // Activity management
        function addEntry(data) {
            console.log('Adding entry:', data);
            const entry = {
                id: appState.entryCounter++,
                date: data.date || new Date().toISOString().split('T')[0],
                startTime: data.startTime || '09:00',
                endTime: data.endTime || '17:00',
                activity: data.activity || 'General Activity',
                notes: data.notes || '',
                hours: calculateHours(data.startTime || '09:00', data.endTime || '17:00')
            };
            
            appState.localEntries[entry.id] = entry;
            updateTotalHours();
            updateHoursStatus();
            updateQuickStats();
            showMessage(`Added ${entry.activity} entry`, 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300');
        }

        function addActivityRow() {
            console.log('Adding activity row');
            const container = document.getElementById('timeLogContainer');
            if (!container) return;
            
            const rowId = 'row_' + Date.now();
            const row = document.createElement('div');
            row.id = rowId;
            row.className = 'bg-gray-50 dark:bg-gray-700 p-4 rounded-lg border border-gray-200 dark:border-gray-600';
            row.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-6 gap-4 items-center">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Date</label>
                        <input type="date" class="date-input w-full p-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white" value="${new Date().toISOString().split('T')[0]}">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Start Time</label>
                        <input type="time" class="start-time-input w-full p-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white" value="09:00">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">End Time</label>
                        <input type="time" class="end-time-input w-full p-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white" value="17:00">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Activity</label>
                        <input type="text" class="activity-input w-full p-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white" placeholder="Activity name">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Notes</label>
                        <input type="text" class="notes-input w-full p-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white" placeholder="Notes">
                    </div>
                    <div class="flex flex-col gap-2">
                        <button class="save-row-btn bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg text-sm transition-colors">Save</button>
                        <button class="delete-row-btn bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm transition-colors">Delete</button>
                    </div>
                </div>
            `;
            
            container.appendChild(row);
            
            // Add event listeners to the new row
            const saveBtn = row.querySelector('.save-row-btn');
            const deleteBtn = row.querySelector('.delete-row-btn');
            
            if (saveBtn) {
                saveBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Save row clicked');
                    saveActivityRow(row);
                });
            }
            
            if (deleteBtn) {
                deleteBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Delete row clicked');
                    deleteActivityRow(row);
                });
            }
        }

        function addInitialRow() {
            addActivityRow();
        }

        function saveActivityRow(row) {
            console.log('Saving activity row');
            const dateInput = row.querySelector('.date-input');
            const startTimeInput = row.querySelector('.start-time-input');
            const endTimeInput = row.querySelector('.end-time-input');
            const activityInput = row.querySelector('.activity-input');
            const notesInput = row.querySelector('.notes-input');
            
            if (!dateInput || !startTimeInput || !endTimeInput || !activityInput) return;
            
            const entry = {
                id: appState.entryCounter++,
                date: dateInput.value,
                startTime: startTimeInput.value,
                endTime: endTimeInput.value,
                activity: activityInput.value,
                notes: notesInput.value || '',
                hours: calculateHours(startTimeInput.value, endTimeInput.value)
            };
            
            appState.localEntries[entry.id] = entry;
            updateTotalHours();
            updateHoursStatus();
            updateQuickStats();
            showMessage('Activity saved successfully', 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300');
        }

        function deleteActivityRow(row) {
            console.log('Deleting activity row');
            row.remove();
        }

        function clearAllEntries() {
            console.log('Clearing all entries');
            if (confirm('Are you sure you want to clear all entries?')) {
                appState.localEntries = {};
                appState.entryCounter = 1;
                updateTotalHours();
                updateHoursStatus();
                updateQuickStats();
                
                const container = document.getElementById('timeLogContainer');
                if (container) {
                    container.innerHTML = '';
                }
                
                showMessage('All entries cleared', 'bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300');
            }
        }

        // Timer functionality
        function toggleTimer() {
            console.log('Toggling timer');
            if (appState.isTimerRunning) {
                stopTimer();
            } else {
                startTimer();
            }
        }

        function startTimer() {
            console.log('Starting timer');
            appState.timerStartTime = Date.now() - appState.timerElapsed;
            appState.isTimerRunning = true;
            
            appState.timerInterval = setInterval(updateTimerDisplay, 1000);
            
            const timerStartStop = document.getElementById('timerStartStop');
            const timerPause = document.getElementById('timerPause');
            const timerSave = document.getElementById('timerSave');
            
            if (timerStartStop) {
                timerStartStop.textContent = 'STOP';
                timerStartStop.className = 'w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white p-4 rounded-lg font-bold text-lg transition-all transform hover:scale-105';
            }
            
            if (timerPause) {
                timerPause.disabled = false;
            }
            
            if (timerSave) {
                timerSave.disabled = false;
            }
        }

        function stopTimer() {
            console.log('Stopping timer');
            appState.isTimerRunning = false;
            
            if (appState.timerInterval) {
                clearInterval(appState.timerInterval);
                appState.timerInterval = null;
            }
            
            const timerStartStop = document.getElementById('timerStartStop');
            const timerPause = document.getElementById('timerPause');
            
            if (timerStartStop) {
                timerStartStop.textContent = 'START';
                timerStartStop.className = 'w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white p-4 rounded-lg font-bold text-lg transition-all transform hover:scale-105';
            }
            
            if (timerPause) {
                timerPause.disabled = true;
                timerPause.textContent = 'PAUSE';
            }
        }

        function pauseTimer() {
            console.log('Pausing timer');
            if (appState.isTimerRunning) {
                appState.isTimerRunning = false;
                if (appState.timerInterval) {
                    clearInterval(appState.timerInterval);
                }
                
                const timerPause = document.getElementById('timerPause');
                if (timerPause) {
                    timerPause.textContent = 'RESUME';
                }
            } else {
                appState.isTimerRunning = true;
                appState.timerStartTime = Date.now() - appState.timerElapsed;
                appState.timerInterval = setInterval(updateTimerDisplay, 1000);
                
                const timerPause = document.getElementById('timerPause');
                if (timerPause) {
                    timerPause.textContent = 'PAUSE';
                }
            }
        }

        function updateTimerDisplay() {
            if (!appState.isTimerRunning) return;
            
            appState.timerElapsed = Date.now() - appState.timerStartTime;
            const hours = Math.floor(appState.timerElapsed / 3600000);
            const minutes = Math.floor((appState.timerElapsed % 3600000) / 60000);
            const seconds = Math.floor((appState.timerElapsed % 60000) / 1000);
            
            const display = document.getElementById('timerDisplay');
            if (display) {
                display.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        function saveTimerActivity() {
            console.log('Saving timer activity');
            const activityName = document.getElementById('timerActivity');
            if (!activityName || !activityName.value.trim()) {
                showMessage('Please enter an activity name', 'bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300');
                return;
            }
            
            const hours = appState.timerElapsed / 3600000;
            const now = new Date();
            const endTime = now.toTimeString().slice(0, 5);
            const startTime = new Date(now.getTime() - appState.timerElapsed).toTimeString().slice(0, 5);
            
            addEntry({
                date: now.toISOString().split('T')[0],
                startTime: startTime,
                endTime: endTime,
                activity: activityName.value,
                notes: `Timer activity (${hours.toFixed(2)} hours)`
            });
            
            // Reset timer
            appState.timerElapsed = 0;
            const timerDisplay = document.getElementById('timerDisplay');
            if (timerDisplay) {
                timerDisplay.textContent = '00:00:00';
            }
            
            const timerStartStop = document.getElementById('timerStartStop');
            const timerPause = document.getElementById('timerPause');
            const timerSave = document.getElementById('timerSave');
            
            if (timerStartStop) {
                timerStartStop.textContent = 'START';
                timerStartStop.className = 'w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white p-4 rounded-lg font-bold text-lg transition-all transform hover:scale-105';
            }
            
            if (timerPause) {
                timerPause.disabled = true;
                timerPause.textContent = 'PAUSE';
            }
            
            if (timerSave) {
                timerSave.disabled = true;
            }
            
            if (activityName) {
                activityName.value = '';
            }
            
            showMessage('Timer activity saved', 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300');
        }

        // Voice note functionality
        function showVoiceModal() {
            console.log('Showing voice modal');
            const modal = document.getElementById('voiceModal');
            if (modal) {
                modal.classList.remove('hidden');
            }
        }

        function hideVoiceModal() {
            console.log('Hiding voice modal');
            const modal = document.getElementById('voiceModal');
            if (modal) {
                modal.classList.add('hidden');
            }
        }

        function toggleVoiceRecording() {
            console.log('Toggling voice recording');
            if (appState.mediaRecorder && appState.mediaRecorder.state === 'recording') {
                stopVoiceRecording();
            } else {
                startVoiceRecording();
            }
        }

        function startVoiceRecording() {
            console.log('Starting voice recording');
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    appState.mediaRecorder = new MediaRecorder(stream);
                    appState.audioChunks = [];
                    
                    appState.mediaRecorder.ondataavailable = event => {
                        appState.audioChunks.push(event.data);
                    };
                    
                    appState.mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(appState.audioChunks, { type: 'audio/wav' });
                        const audioUrl = URL.createObjectURL(audioBlob);
                        console.log('Voice recording completed');
                        showMessage('Voice note recorded successfully', 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300');
                    };
                    
                    appState.mediaRecorder.start();
                    
                    const voiceStatus = document.getElementById('voiceStatus');
                    const voiceRecordBtn = document.getElementById('voiceRecordBtn');
                    const voiceSaveBtn = document.getElementById('voiceSaveBtn');
                    
                    if (voiceStatus) {
                        voiceStatus.textContent = 'Recording... Click to stop';
                    }
                    
                    if (voiceRecordBtn) {
                        voiceRecordBtn.classList.add('voice-recording');
                    }
                    
                    if (voiceSaveBtn) {
                        voiceSaveBtn.disabled = false;
                    }
                })
                .catch(error => {
                    console.error('Error accessing microphone:', error);
                    showMessage('Could not access microphone', 'bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300');
                });
        }

        function stopVoiceRecording() {
            console.log('Stopping voice recording');
            if (appState.mediaRecorder && appState.mediaRecorder.state === 'recording') {
                appState.mediaRecorder.stop();
                
                const voiceStatus = document.getElementById('voiceStatus');
                const voiceRecordBtn = document.getElementById('voiceRecordBtn');
                
                if (voiceStatus) {
                    voiceStatus.textContent = 'Recording stopped. Click to record again.';
                }
                
                if (voiceRecordBtn) {
                    voiceRecordBtn.classList.remove('voice-recording');
                }
            }
        }

        function saveVoiceNote() {
            console.log('Saving voice note');
            hideVoiceModal();
            showMessage('Voice note saved to monthly summary', 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300');
        }

        // Photo functionality
        function handlePhotoUpload(event) {
            console.log('Handling photo upload');
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const photoGallery = document.getElementById('photoGallery');
                if (photoGallery) {
                    const photoDiv = document.createElement('div');
                    photoDiv.className = 'relative';
                    photoDiv.innerHTML = `
                        <img src="${e.target.result}" class="w-full h-20 object-cover rounded-lg">
                        <button class="absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs" onclick="removePhoto(this)">×</button>
                    `;
                    photoGallery.appendChild(photoDiv);
                }
            };
            reader.readAsDataURL(file);
        }

        function removePhoto(button) {
            console.log('Removing photo');
            button.parentElement.remove();
        }

        // Monthly summary
        function saveMonthlySummary() {
            const summary = document.getElementById('monthlySummary');
            if (summary) {
                localStorage.setItem('monthlySummary', summary.value);
            }
        }

        function loadMonthlySummary() {
            const summary = document.getElementById('monthlySummary');
            const saved = localStorage.getItem('monthlySummary');
            if (summary && saved) {
                summary.value = saved;
            }
        }

        // Calendar functionality
        function generateCalendar() {
            console.log('Generating calendar');
            const calendar = document.getElementById('calendar');
            if (!calendar) return;
            
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth();
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();
            
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            
            const currentMonth = document.getElementById('currentMonth');
            if (currentMonth) {
                currentMonth.textContent = `${monthNames[month]} ${year}`;
            }
            
            calendar.innerHTML = '';
            
            // Add day headers
            const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayHeaders.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'font-bold text-gray-600 dark:text-gray-300 p-2';
                dayHeader.textContent = day;
                calendar.appendChild(dayHeader);
            });
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startingDayOfWeek; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'p-2';
                calendar.appendChild(emptyCell);
            }
            
            // Add days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'p-2 border border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer';
                dayCell.textContent = day;
                calendar.appendChild(dayCell);
            }
        }

        function changeMonth(direction) {
            console.log('Changing month:', direction);
            // This would update the calendar month
            generateCalendar();
        }

        // Chart functionality
        function initializeCharts() {
            console.log('Initializing charts');
            
            // Activity breakdown chart
            const activityCtx = document.getElementById('activityChart');
            if (activityCtx && !appState.charts.activity) {
                appState.charts.activity = new Chart(activityCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Help Desk', 'Meetings', 'Events', 'Other'],
                        datasets: [{
                            data: [0, 0, 0, 0],
                            backgroundColor: ['#3B82F6', '#10B981', '#8B5CF6', '#F59E0B']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
            
            // Weekly progress chart
            const weeklyCtx = document.getElementById('weeklyChart');
            if (weeklyCtx && !appState.charts.weekly) {
                appState.charts.weekly = new Chart(weeklyCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                        datasets: [{
                            label: 'Hours',
                            data: [0, 0, 0, 0],
                            backgroundColor: '#D4AF37'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
            
            // Trends chart
            const trendsCtx = document.getElementById('trendsChart');
            if (trendsCtx && !appState.charts.trends) {
                appState.charts.trends = new Chart(trendsCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Monthly Hours',
                            data: [0, 0, 0, 0, 0, 0],
                            borderColor: '#D4AF37',
                            backgroundColor: 'rgba(212, 175, 55, 0.1)',
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
        }

        // Utility functions
        function calculateHours(startTime, endTime) {
            const start = new Date(`2000-01-01T${startTime}:00`);
            const end = new Date(`2000-01-01T${endTime}:00`);
            const diffMs = end - start;
            return Math.max(0, diffMs / (1000 * 60 * 60));
        }

        function updateTotalHours() {
            let total = 0;
            Object.values(appState.localEntries).forEach(entry => {
                total += entry.hours || 0;
            });
            
            const totalHoursElement = document.getElementById('totalHours');
            if (totalHoursElement) {
                totalHoursElement.textContent = total.toFixed(2);
            }
            
            const progressBar = document.getElementById('progressBar');
            if (progressBar) {
                const percentage = Math.min((total / 30) * 100, 100);
                progressBar.style.width = percentage + '%';
            }
        }

        function updateHoursStatus() {
            let total = 0;
            Object.values(appState.localEntries).forEach(entry => {
                total += entry.hours || 0;
            });
            
            const statusElement = document.getElementById('hoursStatus');
            if (statusElement) {
                if (total >= 30) {
                    statusElement.textContent = '✅ Complete';
                    statusElement.className = 'px-4 py-2 rounded-full text-sm font-medium bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300';
                } else {
                    statusElement.textContent = `${(30 - total).toFixed(1)}hrs remaining`;
                    statusElement.className = 'px-4 py-2 rounded-full text-sm font-medium bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300';
                }
            }
        }

        function updateQuickStats() {
            let helpDesk = 0, meetings = 0, events = 0, other = 0;
            
            Object.values(appState.localEntries).forEach(entry => {
                const activity = entry.activity.toLowerCase();
                if (activity.includes('help desk')) {
                    helpDesk += entry.hours || 0;
                } else if (activity.includes('meeting')) {
                    meetings += entry.hours || 0;
                } else if (activity.includes('event')) {
                    events += entry.hours || 0;
                } else {
                    other += entry.hours || 0;
                }
            });
            
            const helpDeskElement = document.getElementById('helpDeskHours');
            const meetingElement = document.getElementById('meetingHours');
            const eventElement = document.getElementById('eventHours');
            const otherElement = document.getElementById('otherHours');
            
            if (helpDeskElement) helpDeskElement.textContent = helpDesk.toFixed(1);
            if (meetingElement) meetingElement.textContent = meetings.toFixed(1);
            if (eventElement) eventElement.textContent = events.toFixed(1);
            if (otherElement) otherElement.textContent = other.toFixed(1);
        }

        function generateReport() {
            console.log('Generating report');
            let report = 'SU PRESIDENT MONTHLY TIMESHEET REPORT\n';
            report += 'City of Wolverhampton College\n';
            report += 'Generated: ' + new Date().toLocaleDateString() + '\n\n';
            
            report += 'ACTIVITY LOG:\n';
            report += 'Date\t\tStart\tEnd\t\tActivity\t\t\tHours\tNotes\n';
            report += '-'.repeat(80) + '\n';
            
            Object.values(appState.localEntries).forEach(entry => {
                report += `${entry.date}\t${entry.startTime}\t${entry.endTime}\t${entry.activity.padEnd(20)}\t${entry.hours.toFixed(2)}\t${entry.notes}\n`;
            });
            
            let totalHours = 0;
            Object.values(appState.localEntries).forEach(entry => {
                totalHours += entry.hours || 0;
            });
            
            report += '\n' + '-'.repeat(80) + '\n';
            report += `TOTAL HOURS: ${totalHours.toFixed(2)}\n`;
            report += `REQUIRED HOURS: 30.00\n`;
            report += `STATUS: ${totalHours >= 30 ? 'COMPLETE' : 'INCOMPLETE'}\n\n`;
            
            const summary = document.getElementById('monthlySummary');
            if (summary && summary.value.trim()) {
                report += 'MONTHLY SUMMARY:\n';
                report += summary.value + '\n';
            }
            
            const outputSection = document.getElementById('outputSection');
            const reportOutput = document.getElementById('reportOutput');
            
            if (outputSection && reportOutput) {
                reportOutput.textContent = report;
                outputSection.classList.remove('hidden');
                showMessage('Report generated successfully', 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300');
            }
        }

        function copyReport() {
            console.log('Copying report');
            const reportOutput = document.getElementById('reportOutput');
            if (reportOutput) {
                navigator.clipboard.writeText(reportOutput.textContent).then(() => {
                    showMessage('Report copied to clipboard', 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300');
                }).catch(() => {
                    showMessage('Failed to copy report', 'bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300');
                });
            }
        }

        function showMessage(message, className) {
            console.log('Showing message:', message);
            const messageBox = document.getElementById('messageBox');
            if (messageBox) {
                messageBox.textContent = message;
                messageBox.className = `fixed top-20 right-4 p-4 rounded-lg shadow-lg z-50 animate-bounce-in ${className}`;
                messageBox.classList.remove('hidden');
                
                setTimeout(() => {
                    messageBox.classList.add('hidden');
                }, 3000);
            }
        }

        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing app...');
            initializeApp();
            setupEventListeners();
            console.log('✅ App loaded successfully!');
        });

        // Global functions for inline event handlers
        window.removePhoto = removePhoto;
    </script>
</body>
</html>
